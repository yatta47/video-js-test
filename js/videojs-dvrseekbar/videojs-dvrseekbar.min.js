/*! @name videojs-dvrseekbar @version 1.0.0 @license Apache-2.0 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):e.videojsDvrseekbar=t(e.videojs)}(this,function(e){"use strict";function t(e){var t=e&&e.tech_&&e.tech_.shakaPlayer;return t&&t.seekRange?t.seekRange():e.seekable&&e.seekable().length>0?{start:e.seekable().start(0),end:e.seekable().end(0)}:{start:0,end:e.duration()}}function r(e){if(e.duration()===1/0){var r=t(e);return r.end-r.start}return e.duration()}var o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},a=function(r){function a(e,t){o(this,a);var i=n(this,r.call(this,e,t));return i.on("click",i.clicked),i.setInterval(i.update,125),i}return i(a,r),a.prototype.createEl=function(){return e.dom.createEl("div",{id:"dvr-current-time",className:"vjs-current-time-display vjs-hidden",innerHTML:"0:00"})},a.prototype.clicked=function(){this.player_.currentTime(t(this.player_).end)},a.prototype.update=function(){var e=t(this.player_),r=e.end-e.start>=3600,o=function(e){var r=t(e),o=e.currentTime(),i=Math.floor(r.end-o);return Math.max(0,i)}(this.player_);this.el().innerHTML=o!==1/0&&o>=15?"- "+function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=Math.floor(e/3600),o=Math.floor(e/60%60),i=Math.floor(e%60);i<10&&(i="0"+i);var n=o+":"+i;return t&&(o<10&&(n="0"+n),n=r+":"+n),n}(o,r):this.localize("LIVE")},a}((e=e&&e.hasOwnProperty("default")?e.default:e).getComponent("Component"));e.registerComponent("LiveButton",a);var s=function(t){function a(){return o(this,a),n(this,t.apply(this,arguments))}return i(a,t),a.prototype.update=function(t,o){var i=this;this.rafId_&&this.cancelAnimationFrame(this.rafId_),this.rafId_=this.requestAnimationFrame(function(){var n=r(i.player_),a=i.player_.duration()===1/0?o*n-n:o*n,s=e.formatTime(Math.abs(a));i.player_.duration()===1/0&&Math.abs(a)<=15?s=i.localize("LIVE"):a<0&&(s="-"+s),i.el_.style.left=t.width*o+"px",i.getChild("timeTooltip").update(t,o,s)})},a}(e.getComponent("MouseTimeDisplay"));e.registerComponent("DvrMouseTimeDisplay",s);var l=function(a){function s(){return o(this,s),n(this,a.apply(this,arguments))}return i(s,a),s.prototype.update_=function(t,o){var i=r(this.player_);this.el_.setAttribute("aria-valuenow",(100*o).toFixed(2)),this.el_.setAttribute("aria-valuetext",this.localize("progress bar timing: currentTime={1} duration={2}",[e.formatTime(t,i),e.formatTime(i,i)],"{1} of {2}")),this.bar.update(e.dom.getBoundingClientRect(this.el_),o)},s.prototype.handleMouseMove=function(o){if(e.dom.isSingleLeftClick(o)){var i=t(this.player_).start,n=r(this.player_),a=this.calculateDistance(o)*n+i;a===n&&(a-=.1),this.player_.currentTime(a)}},s.prototype.getPercent=function(){var e=r(this.player_),o=t(this.player_).start,i=(this.getCurrentTime_()-o)/e;return i>=1?1:i||0},s}(e.getComponent("SeekBar"));l.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"},e.browser.IS_IOS||e.browser.IS_ANDROID||l.prototype.options_.children.splice(1,0,"DvrMouseTimeDisplay"),e.registerComponent("DvrSeekBar",l);var h=function(t){function r(){return o(this,r),n(this,t.apply(this,arguments))}return i(r,t),r.prototype.handleMouseMove=function(t){var r=this.getChild("DvrSeekBar");if(r){var o=r.getChild("DvrMouseTimeDisplay"),i=r.el(),n=e.dom.getBoundingClientRect(i),a=e.dom.getPointerPosition(i,t).x;a>1?a=1:a<0&&(a=0),o&&o.update(n,a)}},r.prototype.handleMouseSeek=function(e){var t=this.getChild("DvrSeekBar");t&&t.handleMouseMove(e)},r.prototype.handleMouseDown=function(e){var t=this.el_.ownerDocument,r=this.getChild("DvrSeekBar");r&&r.handleMouseDown(e),this.on(t,"mousemove",this.throttledHandleMouseSeek),this.on(t,"touchmove",this.throttledHandleMouseSeek),this.on(t,"mouseup",this.handleMouseUp),this.on(t,"touchend",this.handleMouseUp)},r.prototype.handleMouseUp=function(e){var t=this.el_.ownerDocument,r=this.getChild("DvrSeekBar");r&&r.handleMouseUp(e),this.off(t,"mousemove",this.throttledHandleMouseSeek),this.off(t,"touchmove",this.throttledHandleMouseSeek),this.off(t,"mouseup",this.handleMouseUp),this.off(t,"touchend",this.handleMouseUp)},r}(e.getComponent("ProgressControl"));h.prototype.options_={children:["DvrSeekBar"]},e.registerComponent("DvrProgressControl",h);var u=e.getPlugin("plugin"),p={startTime:"LIVE",dvrMinTime:840},d=e.getComponent("SeekBar");d.prototype.dvrTotalTime=function(e){var t=e.seekable();return t&&t.length?t.end(0)-t.start(0):0},d.prototype.handleMouseMove=function(e){var t=void 0,r=void 0;if((t=r=this.player_.seekable())&&t.length){var o=this.calculateDistance(e)*this.dvrTotalTime(this.player_);for(r=t.start(0)+o;r>=t.end(0);)r-=.1;this.player_.currentTime(r)}},d.prototype.updateAriaAttributes=function(){var t=this.player_.seekable()||[];if(t.length){var r=t.end(0),o=this.player_.getCache().currentTime,i=this.player_.scrubbing?o:this.player_.currentTime(),n=void 0;(n=r-i)<0&&(n=0);var a=e.formatTime(n,r),s=Math.round(100*this.getPercent(),2);this.el_.setAttribute("aria-valuenow",s),this.el_.setAttribute("aria-valuetext",(i?"":"-")+a)}};var c=function(r){function a(t,i){o(this,a);var s=n(this,r.call(this,t));return s.options=e.mergeOptions(p,i),s.tech=null,s.shakaPlayer=null,s.seekbar=null,s.liveButton=null,s.player.ready(function(){s.player.addClass("vjs-dvrseekbar")}),s.player.on("loadedmetadata",s.techLoaded.bind(s)),s.player.on("loadeddata",s.init.bind(s)),s}return i(a,r),a.prototype.techLoaded=function(){this.tech=this.player.tech_,this.shakaPlayer=this.tech&&this.tech.shakaPlayer},a.prototype.init=function(){var e=this.player.controlBar,t=e&&e.dvrProgressControl&&e.dvrProgressControl.DvrSeekBar,r=t&&t.playProgressBar;this.player.duration()===1/0?(e.liveButton.show(),this.isDVR()?(e.dvrProgressControl.show(),r.removeChild("TimeTooltip"),this.player.currentTime(this.getCurrentLiveTime(this.options.startTime))):e.dvrProgressControl.hide()):(e.liveButton.hide(),e.dvrProgressControl.show(),r.getChild("TimeTooltip")||r.addChild("TimeTooltip"))},a.prototype.isDVR=function(){return this.shakaPlayer?this.shakaPlayer.seekRange().end-this.shakaPlayer.seekRange().start>this.options.dvrMinTime:this.player.seekable().length>0&&this.player.seekable().end(0)-this.player.seekable().start(0)>this.options.dvrMinTime},a.prototype.getCurrentLiveTime=function(e){var r=t(this.player);return"LIVE"===e?r.end:r.start},a}(u);return c.defaultState={},c.VERSION="1.0.0",e.registerPlugin("dvrseekbar",c),c});
